<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Datograph | VV Anthem</title>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <style>
    body { background: #222; min-height: 100vh; display: flex; justify-content: center; align-items: center; margin: 0; position: relative; overflow: hidden; }
    .visualizer-bg { position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; z-index: 0; pointer-events: none; background: none; }
    .ipod-player { width: 340px; height: 540px; background: #f8f8f8; border-radius: 40px; box-shadow: 0 8px 32px #0008; display: flex; flex-direction: column; align-items: center; position: relative; overflow: hidden; border: 2px solid #e0e0e0; z-index: 2; }
    .ipod-screen { width: 90%; height: 58%; background: #222; border-radius: 24px; margin-top: 24px; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; overflow: hidden; box-shadow: 0 2px 12px #185a9d44; position: relative; }
    .cover-art { width: 100%; height: 100%; object-fit: cover; border-radius: 24px; position: absolute; top: 0; left: 0; z-index: 1; }
    .mini-counter { position: absolute; bottom: 16px; left: 50%; transform: translateX(-50%); color: rgba(255,255,255,0.45); font-family: 'Orbitron', monospace; font-size: 0.6rem; padding: 0; border-radius: 12px; z-index: 2; letter-spacing: 1px; box-shadow: none; border: none; background: none; text-shadow: 0 2px 8px #0008; pointer-events: none; user-select: none; white-space: nowrap; }
    .ipod-wheel { width: 170px; height: 170px; background: #eee; border-radius: 50%; margin-top: 32px; margin-bottom: 32px; box-shadow: 0 2px 12px #185a9d44; display: flex; align-items: center; justify-content: center; position: relative; border: 2px solid #e0e0e0; }
    .wheel-title { position: absolute; top: 28px; left: 50%; transform: translateX(-50%); font-family: 'Oswald', Arial, sans-serif; font-size: 18px; color: #fff; letter-spacing: 2px; font-weight: 700; z-index: 2; pointer-events: none; text-align: center; width: 140px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-transform: uppercase; opacity: 1; line-height: 1; background: none; padding: 0 4px; }
    .wheel-btn { position: absolute; width: 36px; height: 36px; background: none; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 2; transition: background 0.2s; box-shadow: none; }
    .wheel-btn:active { background: #e0e0e0; }
    .btn-rewind { left: 10px; top: 50%; transform: translateY(-50%); }
    .btn-play { bottom: 10px; left: 50%; transform: translateX(-50%); }
    .btn-forward { right: 10px; top: 50%; transform: translateY(-50%); }
    .wheel-btn svg { width: 22px; height: 22px; fill: #888; }
    .wheel-center { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; background: #eee; border-radius: 50%; box-shadow: 0 2px 8px #185a9d22; display: flex; align-items: center; justify-content: center; z-index: 3; border: 2px solid #e0e0e0; pointer-events: none; }
    .wheel-center svg { width: 22px; height: 22px; fill: #eee; }
    @media (max-width: 400px) { .ipod-player { width: 98vw; height: 70vw; min-width: 220px; min-height: 350px;} .ipod-screen { width: 96%; } .ipod-wheel { width: 40vw; height: 40vw; min-width: 90px; min-height: 90px;} .wheel-title { width: 80px; font-size: 10px;} }
  </style>
</head>
<body>
  <canvas class="visualizer-bg" id="visualizer-bg"></canvas>
  <div class="ipod-player">
    <div class="ipod-screen">
      <img class="cover-art" src="vv-anthems/datograph-cover.jpg" alt="Cover Art">
      <div class="mini-counter" id="counter">00:00 | 00:00</div>
    </div>
    <div class="ipod-wheel">
      <div class="wheel-title" id="wheelTitle">DATOGRAPH</div>
      <button class="wheel-btn btn-rewind" id="rewindBtn" title="Rewind 10s">
        <svg viewBox="0 0 60 60"><polygon points="35,10 10,30 35,50"/><polygon points="50,10 25,30 50,50"/></svg>
      </button>
      <button class="wheel-btn btn-play" id="playPauseBtn" title="Play/Pause">
        <svg id="playIcon" viewBox="0 0 60 60"><polygon points="15,10 50,30 15,50"/></svg>
        <svg id="pauseIcon" viewBox="0 0 60 60" style="display:none;"><rect x="15" y="10" width="10" height="40"/><rect x="35" y="10" width="10" height="40"/></svg>
      </button>
      <button class="wheel-btn btn-forward" id="forwardBtn" title="Forward 10s">
        <svg viewBox="0 0 60 60"><polygon points="10,10 35,30 10,50"/><polygon points="25,10 50,30 25,50"/></svg>
      </button>
      <div class="wheel-center">
        <svg viewBox="0 0 60 60"><circle cx="30" cy="30" r="22" stroke="#eee" stroke-width="4" fill="none"/></svg>
      </div>
    </div>
    <audio id="audio" src="vv-anthems/Datograph Song.mp3"></audio>
  </div>
  <script>
    // Audio controls
    const audio = document.getElementById('audio');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const playIcon = document.getElementById('playIcon');
    const pauseIcon = document.getElementById('pauseIcon');
    const rewindBtn = document.getElementById('rewindBtn');
    const forwardBtn = document.getElementById('forwardBtn');
    const counter = document.getElementById('counter');
    const wheelTitle = document.getElementById('wheelTitle');

    function formatTime(sec) {
      if (isNaN(sec)) return '00:00';
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60);
      return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }

    playPauseBtn.addEventListener('click', () => {
      if (audio.paused) {
        audio.play();
        playIcon.style.display = 'none';
        pauseIcon.style.display = 'block';
      } else {
        audio.pause();
        playIcon.style.display = 'block';
        pauseIcon.style.display = 'none';
      }
    });

    audio.addEventListener('timeupdate', () => {
      counter.textContent = `${formatTime(audio.currentTime)} | ${formatTime(audio.duration)}`;
    });

    audio.addEventListener('loadedmetadata', () => {
      counter.textContent = `${formatTime(audio.currentTime)} | ${formatTime(audio.duration)}`;
    });

    audio.addEventListener('ended', () => {
      playIcon.style.display = 'block';
      pauseIcon.style.display = 'none';
    });

    rewindBtn.addEventListener('click', () => {
      audio.currentTime = Math.max(0, audio.currentTime - 10);
    });

    forwardBtn.addEventListener('click', () => {
      audio.currentTime = Math.min(audio.duration, audio.currentTime + 10);
    });

    // Dynamically fit the song title in Oswald, all caps, and scale font size to fit
    function fitTitleFont() {
      const maxWidth = 140; // px
      let fontSize = 18; // px, start large
      wheelTitle.style.fontSize = fontSize + 'px';
      while (wheelTitle.scrollWidth > maxWidth && fontSize > 8) {
        fontSize -= 1;
        wheelTitle.style.fontSize = fontSize + 'px';
      }
    }
    wheelTitle.textContent = 'DATOGRAPH';
    fitTitleFont();

    // --- TRUE CLOSED CIRCULAR WAVEFORM VISUALIZER ---
    const canvas = document.getElementById('visualizer-bg');
    const ctx = canvas.getContext('2d');
    function resizeVisualizerCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeVisualizerCanvas);
    window.addEventListener('DOMContentLoaded', () => {
      resizeVisualizerCanvas();
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    });

    let animationId;
    const numPoints = 256;
    const phaseOffsets = Array.from({length: numPoints}, () => Math.random() * Math.PI * 2);
    function drawVisualizer() {
      resizeVisualizerCanvas();
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // Parameters
      const cx = canvas.width/2;
      const cy = canvas.height/2;
      const baseRadius = Math.min(canvas.width, canvas.height) * 0.28;
      const amplitude = Math.min(canvas.width, canvas.height) * 0.09;
      let t = performance.now() * 0.0045;
      // Build waveform points
      let points = [];
      for (let i = 0; i < numPoints; i++) {
        let angle = (i / numPoints) * Math.PI * 2;
        // Multiple sine waves for organic, energetic motion
        let phase = t*2.5 + phaseOffsets[i];
        let wave = Math.sin(angle*3 + phase) * 0.5 + Math.sin(angle*7 - phase*1.2) * 0.5 + Math.sin(angle*13 + phase*0.7) * 0.3;
        wave = (wave + 1.3) / 2.3; // normalize to 0..1
        let r = baseRadius + wave * amplitude;
        let x = cx + Math.cos(angle) * r;
        let y = cy + Math.sin(angle) * r;
        points.push([x, y]);
      }
      // Draw glow
      for (let glow = 24; glow > 0; glow -= 4) {
        ctx.save();
        ctx.globalAlpha = 0.04;
        ctx.strokeStyle = '#00f2fe';
        ctx.shadowColor = '#00f2fe';
        ctx.shadowBlur = glow*2;
        ctx.lineWidth = 8 + glow;
        ctx.beginPath();
        ctx.moveTo(points[0][0], points[0][1]);
        for (let i = 1; i < points.length; i++) ctx.lineTo(points[i][0], points[i][1]);
        ctx.closePath();
        ctx.stroke();
        ctx.restore();
      }
      // Main line
      ctx.save();
      ctx.globalAlpha = 0.98;
      let grad = ctx.createLinearGradient(cx, cy-baseRadius-amplitude, cx, cy+baseRadius+amplitude);
      grad.addColorStop(0, '#00f2fe');
      grad.addColorStop(0.5, '#00bfff');
      grad.addColorStop(1, '#0a1a3c');
      ctx.strokeStyle = grad;
      ctx.shadowColor = '#00f2fe';
      ctx.shadowBlur = 16;
      ctx.lineWidth = 8;
      ctx.beginPath();
      ctx.moveTo(points[0][0], points[0][1]);
      for (let i = 1; i < points.length; i++) ctx.lineTo(points[i][0], points[i][1]);
      ctx.closePath();
      ctx.stroke();
      ctx.restore();
      animationId = requestAnimationFrame(drawVisualizer);
    }
    audio.addEventListener('play', () => { drawVisualizer(); });
    audio.addEventListener('pause', () => { cancelAnimationFrame(animationId); ctx.clearRect(0, 0, canvas.width, canvas.height); });
    audio.addEventListener('ended', () => { cancelAnimationFrame(animationId); ctx.clearRect(0, 0, canvas.width, canvas.height); });
  </script>
</body>
</html>
